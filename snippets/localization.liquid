{%- if show_language_switcher or show_currency_switcher -%}
<localization-form class="thb-localization-forms {{ class }}">
	{%- form 'localization', id: id -%}
        <input type="hidden" id="selected-currency-input" name="currency" value="{{ localization.country.currency.iso_code }}">
		{%- if show_currency_switcher -%}
		<div class="select">
          <label for="thb-currency-code-{{ id }}">Change your currency</label>
          <select id="thb-currency-code-{{ id }}" name="country_code" class="thb-currency-code resize-select">
          {%- for country in localization.available_countries -%}
            {%- liquid
              assign country_name = country.name
              if settings.use_country_iso_code
                assign country_name = country.iso_code
              endif
            -%}
            <option value="{{ country.iso_code }}" {%- if country.iso_code == localization.country.iso_code %} selected="selected"{% endif %}>{{ country.currency.iso_code }} {{ country.currency.symbol }}</option>
          {%- endfor -%}
          </select>
          <div class="select-arrow">
            <svg viewBox="0 0 10 6" width="11">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M9.354.646a.5.5 0 00-.708 0L5 4.293 1.354.646a.5.5 0 00-.708.708l4 4a.5.5 0 00.708 0l4-4a.5.5 0 000-.708z" fill="currentColor"></path>
            </svg>
          </div>
		</div>
		{%- endif -%}
        {%- if show_language_switcher -%}
		<div class="select">
			<label for="thb-language-code-{{ id }}">{{ 'localization.update_country' | t }}</label>
			<select id="thb-language-code-{{ id }}" name="locale_code" class="d-none thb-language-code resize-select">
		    {%- for language in localization.available_languages -%}
		      <option value="{{ language.iso_code }}" {%- if language == localization.language %} selected="selected"{% endif %}>{{- language.endonym_name | replace:'English','United States' -}}</option>
		    {%- endfor -%}
		  </select>
          <div class="custom-dropdown m-none">
            <button type="button" class="dropdown-btn thb-currency-code">
              <img id="selected-flag" src="https://cdn.shopify.com/s/files/1/0605/8872/0370/files/{{ localization.language.iso_code | downcase | replace:'en','us' }}.png" height="" width="35">
              <span id="selected-country">{{ localization.language.endonym_name | replace:'English','United States' }}</span>
            </button>
            <div class="dropdown-content">
              {%- for language in localization.available_languages -%}
                <div class="dropdown-item{%- if language == localization.language %} selected{% endif %}" data-value="{{ language.iso_code }}">
                  <img src="https://cdn.shopify.com/s/files/1/0605/8872/0370/files/{{ language.iso_code | downcase | replace:'en','us' }}.png" height="" width="35">
                  {{ language.endonym_name | replace:'English','United States' }}
                </div>
              {%- endfor -%}
            </div>
          </div>
          <div class="select-arrow">
            <svg viewBox="0 0 10 6" width="11">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M9.354.646a.5.5 0 00-.708 0L5 4.293 1.354.646a.5.5 0 00-.708.708l4 4a.5.5 0 00.708 0l4-4a.5.5 0 000-.708z" fill="currentColor"></path>
            </svg>
          </div>
		</div>
		{%- endif -%}
	{%- endform -%}
</localization-form>
<script type="load" d-src="{{ 'localization.js' | asset_url }}"></script>
{%- if show_language_switcher -%}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const dropdownBtn = document.querySelector(".dropdown-btn");
    const dropdownContent = document.querySelector(".dropdown-content");
    const dropdownItems = document.querySelectorAll(".dropdown-item");
    const flagImg = document.getElementById("selected-flag");
    const countryText = document.getElementById("selected-country");
    const currencyInput = document.getElementById("selected-currency-input");
    dropdownBtn.addEventListener("click", function () {
      dropdownContent.classList.toggle("show");
    });
    dropdownItems.forEach(item => {
      item.addEventListener("click", function () {
        const currencyCode = this.dataset.value;
        const flagSrc = this.querySelector("img").src;
        const currencyText = this.textContent.trim();
        flagImg.src = flagSrc;
        countryText.textContent = currencyText;
        currencyInput.value = currencyCode;
        dropdownContent.classList.remove("show");
        document.querySelector("localization-form form").submit();
      });
    });
    document.addEventListener("click", function (event) {
      if (!event.target.closest(".custom-dropdown")) {
        dropdownContent.classList.remove("show");
      }
    });
  });
</script>
{% endif %}  
{%- endif -%}