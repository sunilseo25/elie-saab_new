{%- liquid
  assign show_collection_image = section.settings.show_collection_image
  assign show_collection_description = section.settings.show_collection_description
  assign show_subcollections = section.settings.show_subcollections
  assign make_heading_uppercase = section.settings.make_heading_uppercase
  assign text_alignment = section.settings.text_alignment
  assign overlay_color = section.settings.overlay_color
  assign overlay_opacity = section.settings.overlay_opacity
  assign max_container = section.settings['max-container']

  assign image = collection.featured_image
  assign title = collection.title
  assign description = collection.description
  assign collection_handle = collection.handle

  if section.settings.image and collection.handle == 'all'
    assign image = section.settings.image
  endif
-%}
{%- if template == 'search' -%}
  <style>
        .searchcontainer{
          margin:25px 0;
          position:relative;
          display:block;
        }
        .searchcontainer .thb-predictive-search--popular .search-dropdown{
          padding:5px;
        }
            .searchcontainer .thb-predictive-search--popular .search-option{
              padding:0;
            text-align:left;
            }
        .searchcontainer  .thb-predictive-search--popular .search-option a{
            display: flex;
          text-transform:capitalize;
        border: 0px solid transparent;
        border-bottom: 1px solid #f6f6f6;
          border-radius:0px;
          gap:3px;
          margin-top:3px;
        }
            .searchcontainer  .thb-predictive-search--popular .search-option:last-child a{
                  border-bottom: 0px;
            }
         .searchcontainer   .thb-predictive-search--popular div a:hover{
             background-color: #fafafa;
    color:#acacac;
    }
        .searchcontainer svg path{
          stroke:#acacac;
        }

         .searchcontainer   .side-panel-content--has-tabs {
        /* position: absolute; */
        width: 100%;
        /* right: 0;
        left: 0;
               top: calc(100% - 1px); */
        /* opacity: 0;
        visibility: hidden; */

           display:block;
           overflow:hidden;
               background-color: #fff;


           height: var(--height);
        transition: height 0.3s ease-in;
    }
      .searchcontainer   .side-panel-content--has-tabs.active{
            height: var(--height);
        transition: height 0.3s ease-in;
      }
         .searchcontainer   .side-panel-content--has-tabs .thb-predictive-search--popular{
               border:1px solid #d5d5d4;
                 position:relative;
           top:-2px;
               border-radius: 0px 0px 3px 3px;
         }
        .search-box{
          padding:0 8px;
        }
        .search-box #product-grid{
          padding:0;
        }
          .search-box #FacetFiltersForm-bar{
            padding:0  3px;
            margin-top:0px;
          }
      .search-box facet-filters-form.facets--bar{
      justify-content:flex-end;
        position: relative;
    }
         .search-box  .search-input-box {
        position: absolute;
         left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
    }
           .search-box   div#ProductCount{
              text-transform: capitalize;
        }
        @media screen and (max-width:749px){
          .search-box  #ProductCount{
            display:block;
          }
          .search-box facet-filters-form.facets--bar{
            display:block;
          }
          .search-box .search-input-box{
            top:-80%;
          }
          .search-box .thb-filter-count{
            font-weight:400;
            font-size:13px;
          }
          .search-box .collection-empty{
            padding-top:25px;
          }
        }
  </style>
  {%- liquid
    assign show_collection_image = false
    assign show_subcollections = false
    assign title = 'search.heading' | t
  -%}
  {%- capture description %}
		{% assign search_phrase = search.terms | replace: '*', '' %}
		{% if '' != search_phrase %}
			<p>{{ 'search.results_found' | t: count: search.results_count, key: search_phrase }}</p>
		{% endif %}
	{%- endcapture -%}
{%- endif -%}
{{ 'collection-banner.css' | asset_url | stylesheet_tag }}

<div
  class="collection-{{ section.id }} collection-banner collection-banner--heading-uppercase-{{ make_heading_uppercase }}{% if show_collection_image and image %} collection-banner--has-bg{% endif %}"
  style="--overlay-color-rgb: {{ overlay_color.rgb | replace: ' ' , ',' }}; --overlay-opacity: {{ overlay_opacity | divided_by: 100.0 }}"
>
  <div
    class="collection-{{ section.id }} row"
    {% if max_container != blank %}
      style="max-width: {{ max_container }}px"
    {% endif %}
  >
    <div class="small-12 columns">
      {%- if show_collection_image and image -%}
        <div class="collection-banner--image">
          {%- render 'responsive-image', image: image, sizes: '0x350,0x700', priority: 'high' -%}
        </div>
      {%- endif -%}
      <div class="collection-banner--content text-{{ text_alignment }}">
        {% if template == 'search' %}
          <predictive-search class="searchcontainer">
            <form role="search" method="get" class="searchform" action="{{ routes.search_url }}">
              <fieldset>
                <input
                  type="search"
                  class="search-field"
                  placeholder="{{ 'sections.header.search_for' | t }}"
                  value="{{ search.terms | replace: '*', '' }}"
                  name="q"
                  autocomplete="off"
                >
                <button type="submit" class="thb-search-submit">{% render 'svg-icons' with 'search' %}</button>
              </fieldset>
            </form>

            <div class=" side-panel-content--has-tabs">
              {% comment %}
                               {%- if predictive_search.performed -%}
                {%- liquid
                	assign predictive_search_products = predictive_search.resources.products

                	assign predictive_search_queries = predictive_search.resources.queries
                	-%}
                {%- if predictive_search_queries.size > 0 -%}
                	<div class="thb-predictive-search--popular">
                		<span class="thb-predictive-search--label">{{ 'sections.header.suggestions' | t }}</span>
                		<scroll-shadow>
                			<div>
                				{%- for query in predictive_search_queries -%}
                				<a href="{{ query.url }}" class="predictive-search__item link link--text" tabindex="-1">{{ query.styled_text }}</a>
                				{%- endfor -%}
                			</div>
                		</scroll-shadow>
                	</div>
                	{%- endif -%}

                             {% endif %}
              {% endcomment %}
            </div>
          </predictive-search>
        {% endif %}
        {%- if show_collection_description and description != '' -%}
          <div class="collection-banner--description">
            <p>{{ description }}</p>
          </div>
        {%- endif -%}
        {%- if show_subcollections and linklists[collection_handle] != empty -%}
          {%- capture subcollection_links -%}
          {%- for link in linklists[collection_handle].links -%}
            {%- assign link_collection = collections[link.handle] -%}
            {%- if link_collection != blank -%}
              <a href="{{ link_collection.url }}" title="{{ link_collection.title | escape }}" class="text-button{% if show_collection_image and image %} white{% endif %}">{{ link_collection.title }}</a>
            {%- endif -%}
          {%- endfor -%}
          {%- endcapture -%}
          {%- if subcollection_links != '' -%}
            <div class="collection-banner--subcollections">
              {{ subcollection_links }}
            </div>
          {%- endif -%}
        {%- endif -%}
      </div>
    </div>
  </div>
</div>
<script type="load" d-src="{{ 'custom-predictive-search.js' | asset_url }}"></script>
{% schema %}
{
  "name": "Collection banner",
  "settings": [
    {
      "type": "header",
      "content": "Collection page"
    },
    {
      "type": "checkbox",
      "id": "show_collection_image",
      "default": true,
      "label": "Show collection image"
    },
    {
      "type": "checkbox",
      "id": "show_collection_description",
      "default": true,
      "label": "Show collection description"
    },
    {
      "type": "checkbox",
      "id": "show_subcollections",
      "default": true,
      "label": "Show subcollections",
      "info": "Links to subcollections from your menu will appear here. [Learn more.](https://documentation.fuelthemes.net/kb/how-do-i-add-sub-category-links-inside-main-collection-banner/)"
    },
    {
      "type": "checkbox",
      "id": "make_heading_uppercase",
      "default": false,
      "label": "Make heading uppercase"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center",
      "label": "Content alignment"
    },
    {
      "type": "header",
      "content": "Catalog page"
    },
    {
      "type": "paragraph",
      "content": "Learn more about [catalog page](https://help.shopify.com/en/manual/online-store/themes/themes-by-shopify/vintage-themes/customizing-vintage-themes/change-catalog-page)"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Catalog image",
      "info": "Changes the image for the [catalog page](https://help.shopify.com/en/manual/online-store/themes/themes-by-shopify/vintage-themes/customizing-vintage-themes/change-catalog-page). 1920 x 640 px .jpg recommended."
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "overlay_color",
      "label": "Overlay",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "label": "Overlay opacity",
      "default": 20
    },
    {
      "type": "text",
      "id": "max-container",
      "label": "Max container width"
    }
  ]
}
{% endschema %}
