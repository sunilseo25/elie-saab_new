{{- 'facets.css' | asset_url | stylesheet_tag -}}
{{- 'product-grid.css' | asset_url | stylesheet_tag -}}

{%- liquid
  assign full_width = section.settings.full_width
  assign enable_filtering = section.settings.enable_filtering
  assign enable_sorting = section.settings.enable_sorting
  assign show_counts = section.settings.show_counts
  assign sidebar_size = section.settings.sidebar_size
  assign filter_color_swatches = section.settings.filter_color_swatches
  assign pagination_type = section.settings.pagination_type
  assign products_per_page = section.settings.products_per_page
  assign columns_desktop = section.settings.columns_desktop
  assign facets_desktop = section.settings.facets_desktop
  assign max_container = section.settings['max-container']

  unless enable_filtering
    assign facets_desktop = 'drawer'
  endunless
-%}

<style>
  #subcollection_dropdown_val {
    text-transform: capitalize;
  }
  .underline{
    display:none !important;
  }
  @media (min-width:768px){
    .collection-list-menu-wrapper{
       --underline-width: 0;
      --underline-offset-x: 0;
    }
   .collection-list-menu-wrapper::before {
      content: "";
      display: block;
      position: absolute;
      top: calc(100% - 2px);
      height: 2px;
      width: var(--underline-width);
      transform: translateX(var(--underline-offset-x));
      background-color: #000;
      transition: transform 0.5s, width 0.5s;
      border-radius: 10px;
    }
    .collection-title.active-menu{
      position:relative;
      height: 100%;
    }
    .collection-list-menu-wrapper .active-menu a:before{
       content: "";
      display: block;
      opacity:0;
      pointer-events:none;
    }
    .collection-list-menu-wrapper .active-menu a:after{
        content: "";
      display: block;
      position: absolute;
      pointer-events:none;
      
      height: 2px;
      width:100%;
      background-color: #000;
       border-radius: 10px;
      bottom:0;
    }
  }
</style>
<div
  class="row full-width-row"
  {% if max_container != blank %}
    style="max-width: {{ max_container }}px"
  {% endif %}
  id="CollectionMenuList"
>
  {% assign collection_menu = section.settings.collection_menu %}
  <div class="subcollection-list columns" id="SubCollectionList">
    {% if collection_menu.links != blank %}
      <div class="collection-menu">
        <div class="dropdown-collection" {% if collection.metafields.custom.collection_list.value == blank %} style="pointer-events:none" {% endif %} >
          <button class="dropbtn{% if collection.metafields.custom.collection_list.value == blank %} dropbtn_center{% endif %}" type="text">
            <span id="current_collection_title">
              {{ collection.title | truncate: 20 }}
            </span>
            {% if collection.metafields.custom.collection_list.value != blank %}
              <div id="select-arrow" class="select-arrow">
                <svg viewBox="0 0 8 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M6.75 1.5L3.75 4.5L0.75 1.5" stroke="var(--color-body)" stroke-width="1.1" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
              </div>
            {% endif %}
          </button>
          <div id="dropdown-content" class="dropdown-content">
            <div class="dropdown-list-wrapper">
              {% if collection.metafields.custom.collection_list.value != blank %}
                {% for link in collection.metafields.custom.collection_list.value %}
                  <a href="{{ link.url }}" data-title="{{- link.title -}}" class="dropmenuoption">
                    <span>{{- link.title -}}</span>
                  </a>
                {% endfor %}
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    {% endif %}
    <div class="dropdown_card">
      <div class="dropdown_item">
        <div class="subcollection_dropdown">
          <span id="subcollection_dropdown_val">All</span>
          <div id="select-arrow" class="select-arrow">
            <svg viewBox="0 0 8 6" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M6.75 1.5L3.75 4.5L0.75 1.5" stroke="var(--color-body)" stroke-width="1.1" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
          </div>
        </div>
        {% if true %}
          <div class="collection-meta-size">
            <div class="collection-list-menu-wrapper">
               <button class="flt-left collection-slider-left"><svg viewBox="0 0 8 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M6.75 1.5L3.75 4.5L0.75 1.5" stroke="var(--color-body)" stroke-width="1.1" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg> 
              </button>
              <div class="collection-slider-wrap">
                {% assign type_size = 1 %}
                {%- for filter in collection.filters -%}
                  {% if filter.label contains 'Product type' %}
                    <div
                      class="collection-title"
                      data-menu-options="all"
                    >
                      <a data-val="all" href="?filter.p.product_type=" class="link js-link-collection _inner"> All </a>
                    </div>
                    {% for value in filter.values limit: 9 %}
                    {% if value.count > 0 %}
                      {% assign type_size = type_size | plus: 1 %}
                      {% unless value.label == 'Jackets And Blazers' 
                          or value.label == 'Pants And Shorts' 
                          or value.label == 'Tops And Blouses' %}
                        <div
                          class="collection-title{% if forloop.last %} last-child{% endif %}{% if value.active %} active-menu{% endif %}"
                          data-menu-options="{{ value.label | handle }}"
                        >
                          <a
                            data-val="{{ value.label | escape }}"
                            href="?filter.p.product_type={{ value.value }}"
                            class="link js-link-collection _inner"
                          >
                            {{ value.label | escape }} 
                          </a>
                        </div>
                      {% endunless %}
                    {% endif %}
                  {% endfor %}

                  {% endif %}
                {% endfor %}
                {% if type_size < 4 %}
                <style>
                  @media screen and (min-width: 750px) {
                    .collection-meta-size .collection-slider-wrap {
                      justify-content: flex-start;
                    }
                  }
                </style>
                {% endif %}
              </div>
              <button class='flt-right collection-slider-right'  >
                <svg viewBox="0 0 8 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M6.75 1.5L3.75 4.5L0.75 1.5" stroke="var(--color-body)" stroke-width="1.1" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
              </button>
              <div class="underline"></div>
            </div>
          </div>
        {% endif %}
      </div>
      <div class="filter_btn">
        <svg version="1.2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 33 28" width="15">
          <path fill-rule="evenodd" class="s0" d="m23 0.8c2.9 0 5.4 2.2 6 5h2.6c0.7 0 1.2 0.5 1.2 1.2 0 0.7-0.5 1.3-1.2 1.3l-2.6-0.1c-0.6 2.9-3.1 5-6 5-3 0-5.5-2.1-6.1-5h-14.9c-0.7 0-1.3-0.5-1.3-1.2 0-0.7 0.6-1.2 1.3-1.2h14.9c0.6-2.8 3.1-5 6.1-5zm-3.7 6.2c0 2.1 1.6 3.7 3.7 3.7 2 0 3.7-1.6 3.7-3.7 0-2-1.7-3.7-3.7-3.7-2.1 0-3.7 1.7-3.7 3.7z"/>
          <path fill-rule="evenodd" class="s0" d="m10.6 15.7c3 0 5.5 2.1 6.1 4.9h14.9c0.7 0 1.2 0.6 1.2 1.2 0 0.7-0.5 1.3-1.2 1.3h-14.9c-0.6 2.8-3.1 4.9-6.1 4.9-3 0-5.5-2.1-6-4.9h-2.6c-0.7 0-1.3-0.6-1.3-1.3 0-0.6 0.6-1.2 1.3-1.2h2.6c0.5-2.8 3-4.9 6-4.9zm-3.7 6.1c0 2.1 1.7 3.7 3.7 3.7 2.1 0 3.7-1.6 3.7-3.7 0-2-1.6-3.7-3.7-3.7-2 0-3.7 1.7-3.7 3.7z"/>
        </svg>
      </div>
    </div>
  </div>
</div>

<div class="row  {% if full_width %}full-width-row{% endif %}">
  <div class="small-12 columns collection-with-grid">
    {%- paginate collection.products by products_per_page -%}
      <div class="collection-container section-spacing-bottom">
        <div id="ProductGridContainer">
          <div class="sidebar-container facets--{{ facets_desktop }} facets--sidebar-{{ sidebar_size }} results--{{ collection.products.size }}">
            {%- if facets_desktop == 'sidebar' -%}
              {%- render 'facets-desktop',
                results: collection,
                enable_filtering: enable_filtering,
                enable_sorting: enable_sorting,
                show_counts: show_counts,
                filter_color_swatches: filter_color_swatches
              -%}
            {%- endif -%}
            <div>
              <div class="facet-box-wrapper">
                <div class="inner-box-facets">
                  {%- render 'facets-bar',
                    results: collection,
                    enable_filtering: enable_filtering,
                    enable_sorting: enable_sorting,
                    facets_desktop: facets_desktop,
                    filter_color_swatches: filter_color_swatches
                  -%}
                  {%- render 'facets-mobile',
                    results: collection,
                    enable_filtering: enable_filtering,
                    enable_sorting: enable_sorting,
                    show_counts: show_counts,
                    filter_color_swatches: filter_color_swatches
                  -%}
                </div>
              </div>
              {%- if collection.products.size == 0 -%}
                <div class="collection-empty collection" id="product-grid" data-id="{{ section.id }}">
                  <p style="font-size:15px;color:#5e5e5d">
                    {{ 'sections.collection_template.empty' | t -}}
                    <br>
                    {%- if collection.terms -%}
                      {{ 'sections.collection_template.use_fewer_filters_html' | t: link: collection.url }}
                    {%- endif -%}
                  </p>
                </div>
              {%- else -%}
                <ul
                  id="product-grid"
                  data-id="{{ section.id }}"
                  data-pagination = "{{ section.settings.infinite-pagination }}"
                  class="products collection row small-up-2 medium-up-{{ columns_desktop }} pagination--{{ pagination_type }}"
                >
                  {%- assign promotion_rendered = false -%}
                  {%- for product in collection.products -%}
                    {%- assign product_loop = forloop -%}
                    {%- for block in section.blocks -%}
                      {%- liquid
                        assign display_promotion = false
                        if product_loop.index == block.settings.promotion_position and  promotion_rendered == false and paginate.current_page == 1
                          assign display_promotion = true
                        endif                   
                      -%}
                      {%- if display_promotion -%}
                        {{- 'gallery.css' | asset_url | stylesheet_tag -}}
                        <li
                          style="--position:{{ block.settings.promotion_position_mobile }}"
                          class="promotion-column column promotion-column-width--{{ block.settings.promotion_width }} product-columns-{{ columns_desktop }}"
                        >
                          {%- render 'product-promotion', block: block -%}
                        </li>
                     {%- assign promotion_rendered = true -%}
                      {%- endif -%}
                    {%- endfor -%}
                    {% if product.available %}
                      <li class="column grid__item">
                        {%- render 'product-card-v1', product_card_product: product -%}
                      </li>
                    {% endif %}
                  {%- endfor -%}
                </ul>
                {% render 'pagination', paginate: paginate, pagination_type: pagination_type, id: section.id %}
              {%- endif -%}
            </div>
          </div>
        </div>
      </div>
    {%- endpaginate -%}
  </div>
</div>
{%- if enable_filtering or enable_sorting -%}
  {%- if enable_filtering -%}
    {{ 'nouislider.js' | asset_url | script_tag }}
  {%- endif -%}
  <script type="load" d-src="{{ 'facets.js' | asset_url }}"></script>
{%- endif -%}

<script type="load"> 
  $(document).ready(function() {
    const menu = document.querySelector(".collection-list-menu-wrapper");
    menu.addEventListener("mouseover", (event) => {
      if (event.target.classList.contains("link")) {
        menu.style.setProperty(
          "--underline-width",
          `${event.target.offsetWidth}px`
        );
        menu.style.setProperty(
          "--underline-offset-x",
          `${event.target.offsetLeft}px`
        );
      }
    });
    menu.addEventListener("mouseleave", () =>
      menu.style.setProperty("--underline-width", "0")
    );
  });
  
  function applySorting(input) {
    $("#temp_facet_filter input[value='" + input + "']").prop("checked", true);
    $(".mobile-filters-apply").click();
  }
    
  $(document).ready(function() {
    $(window).on('scroll', function() {
      var currentPosition = $(window).scrollTop();
      var stickyElement = $('.facet-box-wrapper');
      if (currentPosition >= 1) {
        if ($("body").hasClass("filter-active")) {
          stickyElement.removeClass('elementStickyScroll');
        } else {
          stickyElement.addClass('elementStickyScroll');
        }
      } else {
        stickyElement.removeClass('elementStickyScroll');
      }
    });
  });
  $("#FacetFiltersForm-bar a").on("click", function() {
    $('.facet-box-wrapper').removeClass('elementStickyScroll');
  });
  
  $("body").on("click", ".js-link-collection", function(e) {
    e.preventDefault();
    let val = $(this).data("val");
    $("facet-filters-form input[type='checkbox']").prop("checked", false);
    $('[data-type="Product type"] .collapsible__content input[value="' + val + '"]').prop("checked", true);
    $('[data-type="Availability"] .collapsible__content input[value="1"]').prop("checked", true);
    $(".collection-title").removeClass("active-menu");
    $(this).parent().addClass("active-menu");
    $(".mobile-filters-apply").click();
    let currentUrl;
    if (val === "all") {
      currentUrl = window.location.pathname + `?filter.p.product_type=&filter.v.availability=1`;
    } else {
      const productType = encodeURIComponent(val);
      currentUrl = window.location.pathname + `?filter.p.product_type=${productType}&filter.v.availability=1`;
    }
    history.pushState({}, "", currentUrl);
  })
  
  $("body").on("click", function(e) {
    console.log(e.target.classList);
    if (e.target.classList.contains("dropdown-toggle-box")) {
  
    } else {
      $("[data-issizeactive]").attr("data-issizeactive", false);
    }
  });
    
  $("body").on("click", ".resetFilters", function(e) {
    e.preventDefault();
    $('facet-filters-form [type="checkbox"]').prop("checked", false);
    if ($("facet-remove").length != 0)
      $(".mobile-filters-apply").click();
  });
</script>

{% schema %}
{
  "name": "Product grid",
  "class": "product-grid-section",
  "settings": [
    {
      "type": "checkbox",
      "id": "full_width",
      "default": false,
      "label": "Make section full width"
    },
    {
      "type": "range",
      "id": "products_per_page",
      "min": 2,
      "max": 48,
      "step": 1,
      "label": "Number of products",
      "default": 12
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 2,
      "max": 5,
      "step": 1,
      "label": "Number of columns on desktop",
      "default": 3
    },
    {
      "type": "link_list",
      "id": "collection_menu",
      "label": "Collection menu"
    },
    {
      "type": "select",
      "id": "pagination_type",
      "options": [
        {
          "value": "paginated",
          "label": "Paginated"
        },
        {
          "value": "loadmore",
          "label": "Click to load"
        },
        {
          "value": "infinite",
          "label": "Infinite"
        }
      ],
      "default": "paginated",
      "label": "Pagination",
      "info": "Choose how additional pages of products are navigated."
    },
    
          {
      "type": "range",
      "id": "infinite-pagination",
      "min": 2,
      "max": 48,
      "step": 1,
      "label": "Pagination items",
      "default": 12
    },
    
    {
      "type": "header",
      "content": "Filtering and sorting"
    },
    {
      "type": "checkbox",
      "id": "enable_filtering",
      "default": true,
      "label": "Enable filtering",
      "info": "Customize [filters](/admin/menus)"
    },
    {
      "type": "checkbox",
      "id": "enable_sorting",
      "default": true,
      "label": "Enable sorting"
    },
    {
      "type": "checkbox",
      "id": "show_counts",
      "default": true,
      "label": "Show filter values count"
    },
    {
      "type": "checkbox",
      "id": "filter_color_swatches",
      "default": true,
      "label": "Show color swatches"
    },
    {
      "type": "select",
      "id": "facets_desktop",
      "options": [
        {
          "value": "sidebar",
          "label": "Sidebar"
        },
        {
          "value": "drawer",
          "label": "Drawer"
        }
      ],
      "default": "sidebar",
      "label": "Desktop position",
      "info": "Position of filters on desktop"
    },
    {
      "type": "select",
      "id": "sidebar_size",
      "options": [
        {
          "value": "small",
          "label": "Small"
        },
        {
          "value": "medium",
          "label": "Medium"
        },
        {
          "value": "large",
          "label": "Large"
        }
      ],
      "default": "medium",
      "label": "Sidebar size",
      "info": "Changes the width of the sidebar"
    },
    {
      "type": "text",
      "id": "max-container",
      "label": "Max container width"
    }
  ],
  "blocks": [
    {
      "type": "promotion",
      "name": "Promotion",
      "settings": [
        {
          "type": "collection",
          "id": "promotion_collection",
          "label": "Collection",
          "info": "Show on specific collection only"
        },
        {
          "type": "range",
          "id": "promotion_position",
          "min": 1,
          "max": 24,
          "step": 1,
          "label": "Show in position on desktop",
          "default": 1
        },
        {
          "type": "range",
          "id": "promotion_position_mobile",
          "min": 1,
          "max": 24,
          "step": 1,
          "label": "Show in position on mobile",
          "default": 1
        },
        {
          "type": "select",
          "id": "promotion_width",
          "options": [
            {
              "value": "1",
              "label": "1 column"
            },
            {
              "value": "2",
              "label": "2 columns"
            }
          ],
          "default": "1",
          "label": "Width"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "video",
          "id": "video",
          "label": "Video"
        },
        {
          "type": "text",
          "id": "title",
          "default": "Promotion",
          "label": "Heading"
        },
        {
          "type": "textarea",
          "id": "text",
          "default": "Advertise a promotion or a sale",
          "label": "Description"
        },
        {
          "id": "link_label",
          "type": "text",
          "label": "Button label",
          "default": "Explore",
          "info": "Leave the label blank to hide the button."
        },
        {
          "id": "link",
          "type": "url",
          "label": "Button link"
        },
        {
          "type": "checkbox",
          "id": "use_text_button",
          "label": "Use text button",
          "default": false
        },
        {
          "id": "block_link",
          "type": "url",
          "label": "Link",
          "info": "This will allow you to set a link to the promotion"
        },
        {
          "type": "header",
          "content": "Layout"
        },
        {
          "type": "select",
          "id": "content_position",
          "label": "Content position",
          "options": [
            {
              "value": "top-left",
              "label": "Top left"
            },
            {
              "value": "top-center",
              "label": "Top center"
            },
            {
              "value": "top-right",
              "label": "Top right"
            },
            {
              "value": "middle-left",
              "label": "Middle left"
            },
            {
              "value": "middle-center",
              "label": "Middle center"
            },
            {
              "value": "middle-right",
              "label": "Middle right"
            },
            {
              "value": "bottom-left",
              "label": "Bottom left"
            },
            {
              "value": "bottom-center",
              "label": "Bottom center"
            },
            {
              "value": "bottom-right",
              "label": "Bottom right"
            }
          ],
          "default": "middle-center"
        },
        {
          "type": "select",
          "id": "text_alignment",
          "options": [
            {
              "value": "left",
              "label": "Left"
            },
            {
              "value": "center",
              "label": "Center"
            },
            {
              "value": "right",
              "label": "Right"
            }
          ],
          "default": "center",
          "label": "Content alignment"
        },
        {
          "type": "header",
          "content": "Colors"
        },
        {
          "type": "color",
          "id": "overlay_color",
          "label": "Overlay",
          "default": "#000000"
        },
        {
          "type": "range",
          "id": "overlay_opacity",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "label": "Overlay opacity",
          "default": 70
        }
      ]
    }
  ],
  "presets": [
    {
      "name":"Product grid"
    }
  ]
}
{% endschema %}